<section class="page-shell feed-postagens">
  <ui-navbar></ui-navbar>

  <ui-card padding="lg" class="composer">
    <div class="form-container">
      <form class="form" (ngSubmit)="aoEnviarPostagem()" #formulario="ngForm">
        <div class="prompt">O que você quer compartilhar hoje?</div>

        <textarea
          placeholder="Escreva algo..."
          type="text"
          name="conteudo"
          [(ngModel)]="formularioPostagem.conteudo"
        ></textarea>

        <div class="checkbox">
          <label>
            <input
              type="checkbox"
              name="anonimo"
              [(ngModel)]="formularioPostagem.anonimo"
              checked
            />
            Modo anônimo
          </label>
        </div>

        <ui-button variant="primary" type="submit">Publicar</ui-button>
      </form>
    </div>
  </ui-card>

  <div class="section-title">Postagens recentes</div>
  <div class="posts">
    <div class="postagem-wrapper" *ngFor="let postagem of postagensApresentacao">
      <postagem-card
        [autor]="postagem.anonimo ? 'Anônimo' : 'Usuário'"
        [tempo]="postagem.dataPublicacao"
        [texto]="postagem.conteudo"
        [likes]="postagem.quantidadeCurtidas"
        [comentarios]="postagem.quantidadeComentarios"
        [curtido]="postagem.curtidaPeloUsuario"
        (alternarCurtida)="alternarCurtida(postagem)"
        (solicitarComentarios)="abrirDialogoComentario(postagem)"
        (abrirDetalhes)="abrirDetalhePostagem(postagem.id)"
      >
      </postagem-card>
    </div>
  </div>

  @if (dialogoComentarioAberto) {
    <div class="comentario-modal-overlay" (click)="fecharDialogoComentario()">
      <div class="comentario-modal" (click)="$event.stopPropagation()">
        <h3>Comentar postagem</h3>
        <p *ngIf="postagemComComentario as selecionada">
          {{ selecionada.anonimo ? 'Anônimo' : 'Usuário' }} -
          {{ (selecionada.conteudo || '') | slice:0:80
          }}{{ (selecionada.conteudo || '').length > 80 ? '...' : '' }}
        </p>
        <textarea
          placeholder="Escreva seu comentário"
          [(ngModel)]="textoComentario"
        ></textarea>
        <div class="modal-acoes">
          <ui-button variant="secondary" (click)="fecharDialogoComentario()">Cancelar</ui-button>
          <ui-button variant="primary" (click)="registrarComentario()">Comentar</ui-button>
        </div>
      </div>
    </div>
  }
</section>
